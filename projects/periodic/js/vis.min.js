var interpolateFloor,mk_periodic_table,niceFormat,perceivable_inverse,vis;vis=void 0,d3.select(document).on("DOMContentLoaded",function(){d3.json("table.json",function(e,t){vis=mk_periodic_table(),vis.root(d3.select("div.vis").append("div").classed("periodic_table",!0)),vis(t)})}),niceFormat=function(e){return Math.log10(e)>3?d3.format(",.4s")(e):d3.format(",.2f")(e)},interpolateFloor=function(e,t){return e=+e,t=+t,function(n){return Math.floor(e*(1-n)+t*n)}},perceivable_inverse=function(e){var t,n,r;return t=d3.hcl(e),r=d3.hcl(e),"black"===e||"#000"===e||"#000000"===e?"white":isNaN(t.h)?"black":(t.h=360-(180+t.h)-180,t.c=100-t.c,t.l=100-t.l,n=Math.sign(t.l-r.l)*Math.exp(Math.log(100)*(100-Math.abs(t.l-r.l))/100)/2,t.l+=n,t)},mk_periodic_table=function(){var e,t,n,r,i,l,a,o,s,c,u,h,d,f,p,g,v,m,b,_,y,x,k,O,w,M,A,z,C,F;return M=void 0,p=void 0,w=void 0,_=void 0,A=void 0,o=void 0,y=void 0,d=void 0,e={path:null,line:null},g=600,z=Math.round(g*(1+Math.sqrt(5))/2),h=z/19,u=1,x={top:5,left:5},F=!1,C=d3.behavior.zoom().scaleExtent([.5,10]).center([(x.left+z)/2,(x.top+g)/2]).size([x.left+z,x.top+g]),k=7,a=colorbrewer.YlOrRd[k],r="by_weight",v="by_weight",t={by_weight:{accessor:function(e,t){return null!=t?e.atomicWeight=t:e.atomicWeight}},by_electronegativity:{accessor:function(e,t){return null!=t?e.eneg=t:e.eneg}},by_boiling_point:{accessor:function(e,t){return null!=t?e.boilingPoint=t:e.boilingPoint}},by_melting_point:{accessor:function(e,t){return null!=t?e.meltingPoint=t:e.meltingPoint}},by_abundance:{accessor:function(e,t){return null!=t?e.abundance=t:e.abundance}},by_density:{accessor:function(e,t){return null!=t?e.density=t:e.density}},by_heat:{accessor:function(e,t){return null!=t?e.heat=t:e.heat}}},O=[["Atomic number","atomicNumber"],["Weight (amu)","atomicWeight"],["Boiling point (K)","boilingPoint"],["Melting point (K)","meltingPoint"],["Electronegativity","eneg"],["Abundance (mg/kg)","abundance"]],f=void 0,i=function(e){var n,i,l;return r?(n=t[r],i=f(n.classify(n.accessor(e))),l=a[i],null==l&&(l=perceivable_inverse(a[k-1])),l):"white"},b=function(e){var n,i,l;return n=t[r],l=a.indexOf(e),0>l?"?":(i=f.invertExtent(l),[n.classify.invert(i[0]),n.classify.invert(i[1])])},A=d3.tip().attr("class","d3-tip").html(function(e){var t,n,r,i,l,a;for(a="<em>"+e.name+" ("+e.sym+")</em><table>",t=0,n=O.length;n>t;t++)l=O[t],r=l[0],i=l[1],a+="<tr> <td>"+r+":</td> <td>"+(null!=e[i]?e[i]:"?")+"</td> </tr>";return a+="</table>"}),n=function(){return p.each(function(e){return e.highlighted=!1,l(e,this)})},m=function(e){return l(e,null,function(){return"blue"}),e.highlighted=!0},vis=function(e){var n,l,a,o,m,b,_,y,O,F;for(d=e,o=0,b=d.length;b>o;o++){n=d[o];for(m in t)O=t[m],F=O.accessor(n),null!=F&&(F=parseFloat(F.replace("[","").replace("]","")),isNaN(F)||(O.accessor(n,F),(null==O.max||O.max<F)&&(O.max=F),(null==O.min||O.min>F)&&(O.min=F)))}for(m in t)O=t[m],y=(O.max-O.min)/k,O.classify=d3.scale.linear().clamp(!0).domain([O.min,O.max]).range([0,1]);return r&&(f=d3.scale.quantile().domain([0,1]).range(d3.range(k))),w.selectAll("*").remove(),M=w.append("svg").attr("width",z+2*x.left).attr("height",g+2*x.top).classed("periodic_table",!0),M.append("g").attr("transform","translate("+x.left+", "+x.top+")"),_={6:3,7:3},p=M.select("g").selectAll("g.element").data(d).enter().append("g"),p.attr("class",function(e){return"element "+e.sym+" "+e.name}).each(function(e){var t;return t=d3.select(this),null!=e.group?(e.x=e.group*h,e.y=e.period*h,e.group>=3&&(e.x+=h),t.classed("group_"+e.group,!0)):(e.x=_[e.period]++*h,e.y=(3+ +e.period)*h,t.classed("nogroup",!0)),t.classed("period_"+e.period,!0)}).attr("transform",function(e){return"translate("+(e.x-h/2)+","+e.y+") scale("+u+")"}),a=function(e){return d3.select(this).style("fill",perceivable_inverse(i(e)))},l=function(e){return d3.select(this).style("fill",i(e)).style("stroke",perceivable_inverse(i(e)))},p.append("rect").classed("element_box",!0).attr("height",h).attr("width",h).attr("x",-h/2).attr("y",-h/2).each(l),p.append("text").classed("symbol box_info",!0).attr("y",7).each(a).text(function(e){return e.sym}),p.append("text").classed("box_info",!0).text(function(e){return niceFormat(e.atomicWeight)}).attr("y",21).each(a),p.append("text").classed("box_info",!0).attr("y",-14).attr("x",14).each(a).text(function(e){return e.atomicNumber}),s(),r&&c(),M.call(C),vis.togglezoom(!1),M.call(A),vis.togglehovertips(!0),vis.heightClass(v),vis},vis.svg=function(){return M},vis.root=function(e){return arguments.length?(w=e,vis):w},vis.classifiers=function(){return t},vis.togglezoom=function(e){return e?C.on("zoom",function(){return F=!(1===d3.event.scale),M.select("g").attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")}):(C.on("zoom",null),M.select("g").attr("transform","translate("+x.left+", "+x.top+")"))},vis.togglehovertips=function(e){return e?p.on("mouseenter",A.show).on("mouseleave",A.hide):p.on("mouseenter",null).on("mouseleave",null)},l=function(e,t,n){return e.highlighted?void 0:(null==n&&(n=i),t=null==t?M.select("g."+e.sym):d3.select(t),t.selectAll("path.element_box, rect.element_box").transition().style("fill",n(e)).style("stroke",perceivable_inverse(n(e))),t.selectAll("line.element_box").transition().style("stroke",perceivable_inverse(n(e))),t.selectAll("text.box_info").transition().style("fill",perceivable_inverse(n(e))))},vis.colClass=function(e){return arguments.length?(r=e,null!=y&&y.remove(),r&&(f=d3.scale.quantile().domain([0,1]).range(d3.range(k)),c()),p.each(function(e){return l(e,this)}),vis):r},vis.heightClass=function(n){return arguments.length?(v=n,v?(u=.7,p.each(function(e){var n,r;return n=t[v],r=n.classify(n.accessor(e)),e._heightOff=r*h*Math.sqrt(2)*(1-u),null==e._heightOff||isNaN(e._heightOff)?e._heightOff=0:void 0}).transition().attr("transform",function(e){return"translate("+(e._heightOff/2+e.x-h/2)+", "+(e.y-e._heightOff/2)+") scale("+u+")"}),null==e.path&&(e.path=p.insert("path",":first-child").style("fill",function(e){return i(e)}).style("stroke",function(e){return perceivable_inverse(i(e))}).attr("class","element_box")),null==e.line&&(e.line=p.insert("line",":nth-child(2)").attr("class","element_box").style("stroke",function(e){return perceivable_inverse(i(e))}).attr("x0",0).attr("y0",0).attr("x1",0).attr("y1",0)),e.path.transition().attr("d",function(e){return"M "+-h/2+" "+-h/2+" l "+-e._heightOff+" "+e._heightOff+" l 0 "+h+" l "+h+" 0 l "+e._heightOff+" "+-e._heightOff+" z"}),e.line.transition().attr("x1",function(e){return-e._heightOff-h/2}).attr("y1",function(e){return e._heightOff+h/2})):(p.selectAll("path, line").remove(),e={path:null,line:null},u=1,p.transition().attr("transform",function(e){return"translate("+(e.x-h/2)+","+e.y+") scale("+u+")"})),vis):v},vis.dimensions=function(e){return arguments.length?(z=e[0],g=e[1],vis):[z,g]},c=function(){var e,n,i,l,s,c;return e=t[r],c=30,l=3,s=z/(k+1)*l*.43,n=Math.ceil((k+1)/l),y=o.append("svg").classed("color_legend",!0).style("display","none").attr("width",n*s).attr("height",l*c*1.1),i=y.selectAll("g.color").data(a.concat([perceivable_inverse(a[k-1])])).enter().append("g").classed("color",!0).attr("transform",function(e,t){return"translate("+(t-t%l)*s/l+", "+t%l*c+")"}),i.append("rect").classed("element_box",!0).attr("width",.8*c).attr("height",.8*c).style("fill",function(e){return e}).style("stroke",function(e){return perceivable_inverse(e)}),i.append("text").attr("y",c/2).attr("x",.85*c).text(function(e){var t;return t=b(e),"string"==typeof t?""+t:niceFormat(t[0])+" - "+niceFormat(t[1])})},s=function(){var e,r,i,l,a,s,c,u,h,f,p;for(null==o&&(o=w.insert("div",":first-child").classed("controls",!0)),l=o.append("div").classed("main_controls",!0),l.append("h1").text("Periodic Table"),h=[["heightClass","Height"],["colClass","Colors"]],a=0,c=h.length;c>a;a++)e=h[a],i=l.append("p"),i.classed("title cell "+e[0],!0).text(e[1]+": "),e=e[0],i.append("span").append("select").attr("onchange","vis."+e+"(this.value)").selectAll("option").data(Object.keys(t).concat([""])).enter().append("option").each(function(t){return t===vis[e]()||!vis[e]()&&!t?d3.select(this).attr("selected","selected"):void 0}).attr("value",function(e){return e}).text(function(e){return e?e.split("_").join(" "):"none"});for(r=l.append("p"),f=["zoom","hovertips"],s=0,u=f.length;u>s;s++)p=f[s],i=r.append("span"),i.append("input").attr("type","checkbox").attr("aria-labelledby","toggle_"+p).attr("id","toggle_"+p+"_checkbox").attr("checked","zoom"===p?null:"checked").on("change",function(e){return function(){return vis["toggle"+e](d3.select(this).property("checked"))}}(p)),i.append("label").attr("id","toggle_"+p).attr("for","toggle_"+p+"_checkbox").text("Toggle "+p);return i=l.append("p"),i.append("label").attr("id","search_label").attr("for","search").text("Search by any property"),i.append("input").attr("type","input").attr("aria-labelledby","search_label").attr("id","search").attr("placeholder","Search here").on("input",function(){var e,t,r,i,l,a,o;if(l={},this.value)for(i=0,r=d.length;r>i;i++){e=d[i];for(t in e)o=e[t],(""+o).toLowerCase().indexOf(this.value.toLowerCase())>=0&&(l[e.name]=e)}n(),a=[];for(t in l)o=l[t],a.push(m(o));return a})},vis};
//# sourceMappingURL=vis.min.js.map