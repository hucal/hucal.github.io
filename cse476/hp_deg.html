<!DOCTYPE html>
<meta charset="utf-8">
<style>

.link {
  fill: none;
  stroke-width: 1.5px;
  stroke-opacity: 0.7;
  stroke: lightgrey;
}

.axis, .node {
  stroke: #000;
  stroke-width: 1.5px;
}

</style>
<body>
<script src="lib/d3.v3.min.js"></script>
<script src="lib/d3.hive.v0.min.js"></script>
<script>

var width = 960,
    height = 700,
    innerRadius = 40,
    outerRadius = 240;

function jiggle(f, add) {
    return function(x){return f(x) + (Math.random() * add - add/2);}
}

var angle = d3.scale.ordinal().domain(d3.range(4)).rangePoints([0, 2 * Math.PI]),
    radius = [
        jiggle(d3.scale.linear().domain([0,5]).range([innerRadius, outerRadius]), 60),
        jiggle(d3.scale.linear().domain([5,100]).range([innerRadius, outerRadius]), 10),
        d3.scale.linear().domain([100,708]).range([innerRadius, outerRadius])
    ],
    color = d3.scale.category10().domain(d3.range(20));


var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

d3.json('reg.json', function(error, graph) {
    links = graph.links;
    nodes = graph.nodes;

    graph.nodes.forEach(function(d) {
        d.angle = angle(classify(d));
        d.radius = radius[classify(d)](d.deg);
    })

    svg.selectAll(".axis")
        .data(d3.range(3))
      .enter().append("line")
        .attr("class", "axis")
        .attr("transform", function(d) { return "rotate(" + degrees(angle(d)) + ")"; })
        .attr("x1", radius[2].range()[0])
        .attr("x2", radius[2].range()[1]);

    svg.selectAll(".link")
        .data(links)
      .enter().append("path")
        .attr("class", "link")
        .attr("d", d3.hive.link()
        .source(function (d) { return nodes[d.source]; })
        .target(function (d) { return nodes[d.target]; })
        .angle(function(d) { return  d.angle; })
        .radius(function(d) { return d.radius; }))
        ;

    svg.selectAll(".node")
        .data(nodes)
      .enter().append("circle")
        .attr("class", "node")
        .attr("transform", function(d) { return "rotate(" + degrees(d.angle) + ")"; })
        .attr("cx", function(d) { return d.radius; })
        .attr("r", 2)
        .append("title").text(function(d){return d.name;})
//        .style("fill", function(d) { return color(d.x); });
        ;
    console.log(nodes);
});

function degrees(radians) {
  return radians / Math.PI * 180 - 90;
}

function classify(d) {
    if (d.deg <  5) return 0;
    if (d.deg >= 5 && d.deg < 100) return 1;
    return 2;
}

</script>

