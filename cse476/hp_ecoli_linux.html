<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Hive Plot of E. Coli and Linux Networks</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="apple-touch-icon" href="../apple-touch-icon.png">

        <link rel="stylesheet" href="../css/normalize.css">
        <link rel="stylesheet" href="../css/main.css">
        <link rel="stylesheet" href="network.css">
        <script src="../js/vendor/modernizr-2.8.3.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
        <h1>Data: E. Coli Gene Regulation Network</h1>
        <p>From RegulonDB</p>
        <p>Node placement along axis: degree</p>
        <p>Axis categories: in, out, in/out</p>
        <div id="vis"></div>

<script src="lib/jquery-1.10.2.min.js"></script>
<script src="lib/colorbrewer.js"></script>
<script src="lib/d3.v3.min.js"></script>
<script src="d3.hive.v0.dev.js"></script>
<script src="hp.js"></script>
<script>

mk_hp("ecoli.json");
mk_hp("linux.json");

function mk_hp(fname) {
    var width = 770,
        height = 800;
    var svg = d3.select("div#vis").append("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("class", "vis")
      .append("g")
        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
    var hive_plot = mk_hive_plot()
            .svg(svg)
            .innerRadius(20)
            .outerRadius(340)
            .node_height(2)
            .node_width (6);
    d3.json(fname, function (error, graph) {
        if (error) { console.log(error); return; }

        by_obj_to_ix(graph.nodes, graph.links);

        extrema = find_degree(graph.nodes, graph.links);
        var min_deg = graph.nodes[extrema[0]],
            max_deg = graph.nodes[extrema[1]];

        graph.nodes[extrema[1]].max_targets = true;

        var angle = d3.scale.ordinal().domain(d3.range(0,3))
                .rangePoints([0, 4/3 * Math.PI]),
            radius = d3.scale.linear()
                .range ([hive_plot.innerRadius(), hive_plot.outerRadius()])
                .domain([min_deg.deg, max_deg.deg]);

        //clone axes
        var rng = angle.range();
        rng[0] = [rng[0], rng[0] - Math.PI / 6];
        rng[2] = [rng[2]];
        rng[1] = [rng[1]];
        angle.range(rng);

        function nada() {return;}
        var col_high = "red",
            col_low = "#444";
        console.log(hive_plot);
        hive_plot
            .angle(angle)
            .radius(radius)
            .nodes(graph.nodes)
            .links(graph.links)
            .elem_radius(function(d) { return radius(d.deg); })
            .elem_angle(function(d) { return angle(
                (d.deg_in === 0 && d.deg_out > 0) ? 2 :
                (d.deg_out === 0 && d.deg_in > 0) ? 1 :
                0
                ); })
            .elem_color(function(d, i, islink) {
                if (islink) d = graph.nodes[d.source];
                return !islink ? col_high : d.max_targets ? col_high : col_low;
            });
        hive_plot();

        svg.selectAll("circle.grid")
            .data(radius.ticks(7))
          .enter().append("g")
            .attr("class", "grid")
            .append("circle")
            .attr("r", function (d) { return radius(d); });

        svg.append("text")
            .attr("class", "title")
            .attr("y", -hive_plot.outerRadius())
            .text(fname);

        svg.selectAll("text.axis-label")
            .data(angle.range())
          .enter().append("text")
            .attr("class", "axis-label")
            .attr("x", function (d) { return hive_plot.outerRadius() * Math.cos(d3.mean(d)); })
            .attr("y", function (d) { return hive_plot.outerRadius() * Math.sin(d3.mean(d)); })
            .attr("text-anchor", "middle")
            .style("font-weight", "bold")
            .text( function(d,i) { return i === 2 ? "regulators"
                : i == 1 ? "workhorses" : "managers"; } );
    });

}
</script>
</body>
</html>

